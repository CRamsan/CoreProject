apply plugin: "com.android.library"
apply plugin: "kotlin-android"
apply plugin: "kotlin-kapt" // Kotlin Annotation Processor
apply from: "$rootDir/gradle/detekt.gradle"

android {
    compileSdkVersion 33

    defaultConfig {
        minSdkVersion 26
        targetSdkVersion 33
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }

    compileOptions {
        // Set the compile options for Java source
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
    }

    kotlin {
        jvmToolchain(17)
    }

    kotlinOptions {
        // Set the compile target for Kotlin source
        freeCompilerArgs += "-opt-in=kotlin.RequiresOptIn"
    }

    packaging {
        resources {
            excludes += "/META-INF/**"
        }
    }

    testOptions {
        unitTests {
            includeAndroidResources = true

            // Allows framework calls to return default values. I should look if I can remove this.
            // Instead we could relly on the testing framework to mock system calls.
            returnDefaultValues = true

            all {
                // Enable printing the result of the unit tests.
                testLogging {
                    events "passed", "skipped", "failed"
                }
            }
        }
    }
}

dependencies {
    implementation Kotlin.stdlib.jdk8
    implementation KotlinX.coroutines.core
    implementation KotlinX.coroutines.android

    testImplementation AndroidX.test.core
    testImplementation AndroidX.test.ext.junit
    testImplementation AndroidX.test.ext.junit.ktx
    testImplementation AndroidX.archCore.common
    testImplementation AndroidX.archCore.runtime
    testImplementation AndroidX.archCore.testing
    testImplementation KotlinX.coroutines.test
    testImplementation Testing.junit4
    testImplementation Kotlin.test
    testImplementation Kotlin.test.junit
    testImplementation Testing.mockK
    testImplementation Testing.mockK.android

    androidTestImplementation AndroidX.test.ext.junit
    androidTestImplementation AndroidX.test.ext.junit.ktx
    androidTestImplementation AndroidX.test.core
    androidTestImplementation AndroidX.test.rules
    androidTestImplementation KotlinX.coroutines.test
    androidTestImplementation Testing.junit4
    androidTestImplementation Kotlin.test
    androidTestImplementation Kotlin.test.junit
    androidTestImplementation Testing.mockK.android
    androidTestImplementation Testing.robolectric
}

tasks.register("releaseAndroid") {
    group = 'build'
    description = 'Run all the steps to build a release artifact'

    dependsOn 'build' // Assembles and test this project
    dependsOn 'detekt' // Run the code analyzer
}

tasks.register("release") {
    group = 'build'
    description = 'Run releaseAndroid'

    dependsOn 'releaseAndroid'
}