apply plugin: "com.android.application"
apply from: "$rootDir/gradle/android-app.gradle"

android {
    defaultConfig {
        applicationId "com.cesarandres.ps2link"
        versionName "5.7.3"

        def consumerSecret = findProperty("ps2linkConsumerSecret") ?: ""
        def consumerKey = findProperty("ps2linkConsumerKey") ?: ""
        def accessToken = findProperty("ps2linkAccessToken") ?: ""
        def accessTokenSecret = findProperty("ps2linkAccessTokenSecret") ?: ""
        def appCenterIdPreProd = findProperty("ps2linkAppCenterIdPreProd") ?: ""
        def appCenterIdProd = findProperty("ps2linkAppCenterIdProd") ?: ""
        def serviceIdPreProd = findProperty("ps2linkServiceIdPreProd") ?: ""
        def serviceIdProd = findProperty("ps2linkServiceIdProd") ?: ""
        def awsAccessKeyPreProd = findProperty("ps2linkAwsAccessKeyPreProd") ?: ""
        def awsSecretKeyPreProd = findProperty("ps2linkAwsSecretKeyPreProd") ?: ""
        def awsAccessKeyProd = findProperty("ps2linkAwsAccessKeyProd") ?: ""
        def awsSecretKeyProd = findProperty("ps2linkAwsSecretKeyProd") ?: ""

        buildConfigField("String", "CONSUMER_SECRET", "\"${consumerSecret}\"")
        buildConfigField("String", "CONSUMER_KEY", "\"${consumerKey}\"")
        buildConfigField("String", "ACCESS_TOKEN", "\"${accessToken}\"")
        buildConfigField("String", "ACCESS_TOKEN_SECRET", "\"${accessTokenSecret}\"")

        productFlavors {
            preprod {
                buildConfigField("String", "APP_CENTER_ID", "\"${appCenterIdPreProd}\"")
                buildConfigField("String", "CENSUS_SERVICE_ID", "\"${serviceIdPreProd}\"")
                resValue("string", "aws_access_key", "${awsAccessKeyPreProd}")
                resValue("string", "aws_secret_key", "${awsSecretKeyPreProd}")
            }
            prod {
                buildConfigField("String", "APP_CENTER_ID", "\"${appCenterIdProd}\"")
                buildConfigField("String", "CENSUS_SERVICE_ID", "\"${serviceIdProd}\"")
                resValue("string", "aws_access_key", "${awsAccessKeyProd}")
                resValue("string", "aws_secret_key", "${awsSecretKeyProd}")
            }
        }
    }

    packagingOptions {
        exclude 'software/amazon/awssdk/global/handlers/execution.interceptors'
    }

    buildFeatures {
        // Enables Jetpack Compose for this module
        compose true
        viewBinding true
        buildConfig = true
    }

    kotlinOptions {
    }

    composeOptions {
        kotlinCompilerExtensionVersion "1.4.6"
    }
    namespace 'com.cesarandres.ps2link'
}

dependencies {
    implementation project(":framework")
    implementation project(":framework:core-compose")
    implementation project(":auraxiscontrolcenter:appcore")
    implementation project(":auraxiscontrolcenter:core-models")
    implementation project(':auraxiscontrolcenter:deployable-models')
    implementation project(":auraxiscontrolcenter:ui")

    implementation AndroidX.appCompat
    implementation AndroidX.activity.ktx
    implementation AndroidX.fragment.ktx
    implementation AndroidX.lifecycle.liveDataKtx
    implementation AndroidX.lifecycle.viewModelKtx
    implementation AndroidX.lifecycle.runtime.ktx
    implementation AndroidX.paging.runtimeKtx
    implementation AndroidX.recyclerView
    implementation AndroidX.preference
    implementation AndroidX.preference.ktx
    implementation AndroidX.navigation.fragmentKtx
    implementation AndroidX.navigation.uiKtx
    implementation AndroidX.work.runtimeKtx
    implementation AndroidX.work.runtime
    implementation Google.android.material
    implementation AndroidX.constraintLayout
    implementation AndroidX.test.espresso.idlingResource
    implementation AndroidX.compose.ui
    implementation AndroidX.compose.ui.tooling
    implementation AndroidX.compose.foundation
    implementation AndroidX.compose.material
    implementation AndroidX.compose.material.icons.core
    implementation AndroidX.compose.material.icons.extended
    implementation AndroidX.compose.runtime.liveData
    implementation KotlinX.datetime
    implementation KotlinX.collections.immutable
    implementation KotlinX.serialization.json
    implementation "com.microsoft.appcenter:appcenter:_"
    implementation "com.microsoft.appcenter:appcenter-crashes:_"
    implementation Ktor.client.android
    implementation "org.ocpsoft.prettytime:prettytime:_"
    implementation Square.sqlDelight.drivers.android

    testImplementation project(":framework:test")

    androidTestImplementation AndroidX.test.runner
    androidTestImplementation AndroidX.test.espresso.intents
    androidTestImplementation AndroidX.test.espresso.core
    androidTestImplementation AndroidX.test.uiAutomator
    androidTestImplementation "com.microsoft.appcenter:espresso-test-extension:_"
}

registerDependency(":framework")
registerDependency(":framework:core-compose")
registerDependency(":auraxiscontrolcenter:appcore")
registerDependency(":auraxiscontrolcenter:core-models")
registerDependency(":auraxiscontrolcenter:deployable-models")
registerDependency(":auraxiscontrolcenter:ui")
