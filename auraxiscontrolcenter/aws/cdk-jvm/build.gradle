import org.apache.tools.ant.taskdefs.condition.Os

ext.mainClassTarget = "com.cesarandres.ps2link.aws.PS2LinkApp"

apply from: "$rootDir/gradle/kotlin-jvm-application.gradle"

dependencies {
    implementation meta_packages.CdkCommons
}

def synthesize = task synthesize(type:Exec) {
    group = 'cdk'
    description = 'Synthesize the cloud formation'

    workingDir "$projectDir"

    if (Os.isFamily(Os.FAMILY_WINDOWS)) {
        commandLine 'cmd', '/c', 'cdk', 'synthesize'
    } else {
        commandLine "cdk", "synthesize"
    }
}

def forceDeploy = task forceDeploy(type:Exec) {
    group = 'cdk'
    description = 'Deploy this stack to the AWS account'

    workingDir "$projectDir"

    if (Os.isFamily(Os.FAMILY_WINDOWS)) {
        commandLine 'cmd', '/c', 'cdk', 'deploy', '--require-approval', 'never'
    } else {
        commandLine "cdk", "deploy", "--require-approval", "never"
    }
}

releaseJvm {
    dependsOn "run"
}